<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø³Ø¨Ø§Ù‚ Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø¬ÙˆØ§Ø¯ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù…</title>

<style>
body{
  margin:0;
  font-family:Tahoma, Arial;
  background:#071c1b;
  color:#fff;
}
.wrap{
  max-width:900px;
  margin:auto;
  padding:20px;
  text-align:center;
}
.card{
  background:#0e2a28;
  border-radius:20px;
  padding:20px;
  margin-top:20px;
}
button{
  padding:12px 18px;
  border-radius:12px;
  border:0;
  font-size:16px;
  cursor:pointer;
  margin:6px;
}
.primary{background:#f59e0b;font-weight:bold}
.green{background:#22c55e}
.red{background:#ef4444}
.gray{background:#64748b}
.timer{font-size:60px;margin:20px 0}
.option{
  background:#083331;
  margin:8px 0;
  padding:12px;
  border-radius:10px;
  cursor:pointer;
}
.option:hover{background:#115e59}
.active{background:#22c55e;color:#000}
.hidden{display:none}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body>
<div class="wrap">
  <h1>Ø³Ø¨Ø§Ù‚ Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø¬ÙˆØ§Ø¯ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø³Ù„Ø§Ù…</h1>
  <p>Ù…Ø³Ø§Ø¨Ù‚Ø© ØªÙØ§Ø¹Ù„ÙŠØ© â€” Ù„Ø¬Ù†Ø© Ù…Ù†Ø§Ø¨Ø± Ø§Ù„Ù†ÙˆØ± Ø¨Ø§Ù„Ø¬ÙØ±</p>

  <div class="card">
    <div id="waiting">â³ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø¨Ø§Ù‚ Ù…Ù† Ø§Ù„Ù…Ù†Ø¸Ù…</div>

    <div id="playerBox">
      <input id="name" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ" style="padding:14px;width:100%;border-radius:12px">
      <button class="primary" onclick="join()">ØªØ³Ø¬ÙŠÙ„</button>
    </div>

    <div class="timer" id="timer">00:00</div>

    <div id="questionBox" class="hidden">
      <h3 id="qText"></h3>
      <div id="choices"></div>
      <button class="gray" onclick="prevQ()">â¬… Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
      <button class="primary" onclick="nextQ()">Ø§Ù„ØªØ§Ù„ÙŠ â¡</button>
    </div>

    <div id="adminBox" class="hidden">
      <button class="green" onclick="startRace()">â–¶ Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ø¨Ø§Ù‚</button>
      <button class="red" onclick="resetRace()">â™» ØªØµÙÙŠØ±</button>
      <button class="green" onclick="seedQuestions()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</button>
    </div>
  </div>
</div>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyCXRjGFao0aRxTU1zPnM80-I7NW5YP-yBM",
  authDomain: "jawad-race.firebaseapp.com",
  projectId: "jawad-race"
});
const db = firebase.firestore();

const isAdmin = new URLSearchParams(location.search).get("admin")==="1";
if(isAdmin) document.getElementById("adminBox").classList.remove("hidden");

const raceRef = db.collection("races").doc("current");
const playersRef = db.collection("players");
const questionsRef = db.collection("questions");

let questions=[], index=0;

async function join(){
  const name=document.getElementById("name").value.trim();
  if(name.length<5){alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ");return;}
  await playersRef.add({name,joinedAt:firebase.firestore.FieldValue.serverTimestamp()});
  alert("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„");
}

raceRef.onSnapshot(doc=>{
  if(!doc.exists)return;
  if(doc.data().status==="running"){
    document.getElementById("waiting").style.display="none";
    loadQuestions();
  }
});

async function loadQuestions(){
  const snap=await questionsRef.orderBy("order").get();
  questions=snap.docs.map(d=>d.data());
  document.getElementById("questionBox").classList.remove("hidden");
  showQ();
}

function showQ(){
  const q=questions[index];
  document.getElementById("qText").innerText=q.text;
  const box=document.getElementById("choices");
  box.innerHTML="";
  q.choices.forEach((c,i)=>{
    const d=document.createElement("div");
    d.className="option";
    d.innerText=c;
    d.onclick=()=>d.classList.add("active");
    box.appendChild(d);
  });
}

function nextQ(){ if(index<questions.length-1){index++;showQ();}}
function prevQ(){ if(index>0){index--;showQ();}}

function startRace(){
  raceRef.set({status:"running",startAt:new Date()});
}
function resetRace(){
  raceRef.set({status:"waiting"});
}

async function seedQuestions(){
  const qs=[
    {order:1,text:"Ø£ÙŠÙ† ÙˆÙÙ„Ø¯ Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø¬ÙˆØ§Ø¯ (Ø¹)ØŸ",choices:["Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©","Ù…ÙƒØ©","Ø§Ù„ÙƒÙˆÙØ©","Ø¨ØºØ¯Ø§Ø¯"],correctIndex:0},
    {order:2,text:"Ù…Ù† ÙˆØ§Ù„Ø¯Ù‡ØŸ",choices:["Ø§Ù„ÙƒØ§Ø¸Ù…","Ø§Ù„Ø±Ø¶Ø§","Ø§Ù„ØµØ§Ø¯Ù‚","Ø§Ù„Ù‡Ø§Ø¯ÙŠ"],correctIndex:1},
    {order:3,text:"Ø¹Ù…Ø±Ù‡ Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ù…Ø§Ù…Ø©ØŸ",choices:["8","15","25","40"],correctIndex:0},
    {order:4,text:"Ù„Ù‚Ø¨Ù‡ Ø§Ù„Ø£Ø´Ù‡Ø±ØŸ",choices:["Ø§Ù„Ø¨Ø§Ù‚Ø±","Ø§Ù„ØªÙ‚ÙŠ","Ø§Ù„ØµØ§Ø¯Ù‚","Ø§Ù„Ø³Ø¬Ø§Ø¯"],correctIndex:1},
    {order:5,text:"Ø£ÙŠÙ† Ø§Ø³ØªØ´Ù‡Ø¯ØŸ",choices:["Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©","Ø¯Ù…Ø´Ù‚","Ø¨ØºØ¯Ø§Ø¯","Ø§Ù„ÙƒÙˆÙØ©"],correctIndex:2},
    {order:6,text:"Ù…Ø±Ù‚Ø¯Ù‡ØŸ",choices:["ÙƒØ±Ø¨Ù„Ø§Ø¡","Ø§Ù„Ù†Ø¬Ù","Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©","Ø§Ù„ÙƒØ§Ø¸Ù…ÙŠØ©"],correctIndex:3},
    {order:7,text:"Ø§Ù„Ø¥Ù…Ø§Ù… Ø¨Ø¹Ø¯Ù‡ØŸ",choices:["Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ","Ø§Ù„Ù‡Ø§Ø¯ÙŠ","Ø§Ù„ØµØ§Ø¯Ù‚","Ø§Ù„Ø¨Ø§Ù‚Ø±"],correctIndex:1},
    {order:8,text:"Ù…Ù† Ø£Ø¨Ù†Ø§Ø¦Ù‡ØŸ",choices:["Ø§Ù„Ù…Ù‡Ø¯ÙŠ","Ø§Ù„Ù‡Ø§Ø¯ÙŠ","Ø§Ù„Ø­Ø³Ù†","Ù„Ø§ Ø£Ø­Ø¯"],correctIndex:1},
    {order:9,text:"Ø§Ø´ØªÙ‡Ø± Ø¨Ù€ØŸ",choices:["Ø§Ù„ÙƒØ±Ù…","Ø§Ù„Ø¹Ø²Ù„Ø©","Ø§Ù„ØªØ¬Ø§Ø±Ø©","Ø§Ù„Ù‚ÙˆØ©"],correctIndex:0},
    {order:10,text:"Ø¹Ø¨Ø§Ø¯ØªÙ‡ØŸ",choices:["Ø¹Ø§Ø¯ÙŠØ©","Ø¶Ø¹ÙŠÙØ©","Ø¹Ø¸ÙŠÙ…Ø©","ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©"],correctIndex:2}
  ];
  for(const q of qs){
    await questionsRef.doc(String(q.order)).set(q);
  }
  alert("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©");
}
</script>
</body>
</html>
